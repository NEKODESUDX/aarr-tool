<!DOCTYPE html>
<html lang="ja">
<head>
   <meta charset="UTF-8">
   <title>AARR tool</title>
   <meta name="description" content="message tool">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <meta name="theme-color" content="blue">
   <meta property="og:title" content="AARR tool">
   <meta property="og:description" content="メッセージ送信ツールです">
   <meta property="og:image" content="https://i.imgur.com/rApLvfn.png">
   <link rel="stylesheet" href="style.css">

   <style>
       /* 全体のスタイル */
       body {
           font-family: "Arial", sans-serif;
           margin: 0;
           padding: 0;
           background-color: #36393F;
           color: #FFFFFF;
       }

       /* コンテナのスタイル */
       #app {
           max-width: 800px;
           margin: 20px auto;
           background-color: #2F3136;
           padding: 20px;
           border-radius: 8px;
           box-shadow: 0 4px 10px rgba(0, 0, 0, 0.5);
       }

       /* タイトルや説明用のスタイル */
       h1, h2 {
           color: #FFFFFF;
       }

       .description {
           background-color: #202225;
           padding: 15px;
           border-radius: 8px;
           color: #B9BBBE;
           margin-bottom: 20px;
       }

       /* 入力フィールドのスタイル */
       input, textarea {
           width: calc(100% - 24px);
           padding: 10px;
           margin: 10px 0;
           border: none;
           border-radius: 5px;
           background-color: #40444B;
           color: #FFFFFF;
           font-size: 14px;
       }

       textarea {
           resize: vertical;
           height: 100px;
       }

       /* ボタンのスタイル */
       button {
           padding: 10px 20px;
           margin: 5px 0;
           background-color: #5865F2;
           color: #FFFFFF;
           border: none;
           border-radius: 5px;
           font-size: 14px;
           cursor: pointer;
           transition: background-color 0.2s;
       }

       button:hover {
           background-color: #4752C4;
       }

       button:disabled {
           background-color: #4F545C;
           cursor: not-allowed;
       }

       /* カードやセクションを分けるスタイル */
       .card {
           background-color: #202225;
           padding: 15px;
           border-radius: 8px;
           margin-bottom: 20px;
           box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
       }

       /* リンクのスタイル */
       a {
           color: #5865F2;
           text-decoration: none;
       }

       a:hover {
           text-decoration: underline;
       }
#logContainer {
    max-height: 200px;
    overflow-y: auto;
    background-color: #202225;
    padding: 10px;
    border-radius: 8px;
    margin-top: 20px;
}


/* 投票入力フィールドのスタイル */
.poll-input {
    width: calc(100% - 20px);
    padding: 10px;
    margin: 10px 0;
    border: none;
    border-radius: 5px;
    background-color: #40444B;
    color: #FFFFFF;
    font-size: 14px;
}

/* チェックボックスの間隔調整 */
#pollOptions input[type="checkbox"] {
    transform: scale(1.5);
    margin-right: 5px;
}

/* ラベルの余白をリセット */
#pollOptions label {
    margin: 0;
    font-size: 16px;
    color: #FFFFFF;
}
/* 入力フィールドとボタンのスタイル */
#serverId {
    width: calc(100% - 20px);
    padding: 10px;
    margin: 10px 0;
    border: none;
    border-radius: 5px;
    background-color: #40444B;
    color: #FFFFFF;
    font-size: 14px;
}

button {
    padding: 10px 20px;
    background-color: #5865F2;
    color: #FFFFFF;
    border: none;
    border-radius: 5px;
    font-size: 14px;
    cursor: pointer;
    transition: background-color 0.2s;
}

button:hover {
    background-color: #4752C4;
}

/* カードのスタイル */
.card {
    background-color: #202225;
    padding: 15px;
    border-radius: 8px;
    margin-bottom: 20px;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
}



   </style>
</head>
<body>
   <div id="app">
         <h1>AARR tool</h1>
<div class="description">
    <p>Web Tool</p>
    <a href="https://discord.gg/DPmPdpcNqs" target="_blank">開発者サポートサーバー (Discord)</a><br>
    <a href="https://youtu.be/NTrzk7bxotg?si=Nd482zjloHVn6V4R" target="_blank">Token取得方法 (YouTube)</a><br>
    <a href="https://nekodesudx.github.io/DM/" target="_blank">グループ追加ツール (GitHub)</a><br>
    <a href="https://nekodesudx.github.io/emoji-ja/" target="_blank">絵文字追加ツール (GitHub)</a><br>
    <a href="https://github.com/NEKODESUDX/AARR-py/tree/main" target="_blank">リアクション追加ツール (GitHub)</a><br>

    <h2>依存環境</h2>
    <a href="https://greasyfork.org/ja/scripts/518295-discord-uid-extractor" target="_blank">全UserID取得拡張機能 [必須]</a><br>

    <h2>Wiki</h2>
    <a href="https://github.com/hatchingchick/wiki/wiki/%E8%8D%92%E3%82%89%E3%81%97%E3%81%AE%E3%83%87%E3%83%BC%E3%82%BF%E3%83%99%E3%83%BC%E3%82%B9" target="_blank">荒らしのテクニックなど</a><br>

    <h2>Note:</h2>
    <p>このツールはGitHub上で動作するブラウザツールであるため、joinは手動で行う必要があります。</p>
    <p>ランダムメンションの数を増やし過ぎるとAutoModに検知されやすくなります。</p>
    <p>また、サーバーによっては自動検知されることがあります。</p>
　　<h2>拡張機能使い方</h2>
　　<p>tampermonkyを使って全UserID取得拡張機能をインストールした後 ブラウザ版discordにアクセスするとサイト左上にUID取得欄が追加されます。取得したら改行で区切ってこのツールのユーザーID欄に入力してください(拡張機能は依存環境を参照)</p>
</div>

       </div>
       <div class="card">
           <label for="tokenField">トークン:</label>
           <textarea id="tokenField" placeholder="ユーザートークンを改行で区切って入力してください\n\n例:\nXXXXXXXXXXXXXXXXXX\nXXXXXXXXXXXXXXXXXX"></textarea>
       </div>
       <div class="card">
    <label for="serverId">サーバーID:</label>
    <input type="text" id="serverId" placeholder="DiscordサーバーIDを入力">
    <button id="showWidget">IDからウィジェットを表示</button>
</div>

<div class="card" id="widgetContainer" style="margin-top: 20px; display: none;">
    <h3>サーバーウィジェット</h3>
    <iframe id="discordWidget" 
            width="350" 
            height="500" 
            allowtransparency="true" 
            frameborder="0" 
            sandbox="allow-popups allow-popups-to-escape-sandbox allow-same-origin allow-scripts">
    </iframe>
</div>

       <div class="card">
           <label for="inputChannelId">チャンネルID:</label>
           <textarea id="inputChannelId" placeholder="発言するチャンネルのIDを改行で区切って入力\n\n例:\nXXXXXXXXXXXXXXXXXX\nXXXXXXXXXXXXXXXXXX"></textarea>
           <button id="copyChannelId">コピー</button>
           <button id="clearChannelId">クリア</button>
       </div>
       <div class="card">
           <label for="inputUserId">ユーザーID:</label>
           <textarea id="inputUserId" placeholder="メンションするユーザーのIDを改行で区切って入力\n\n例:\nXXXXXXXXXXXXXXXXXX\nXXXXXXXXXXXXXXXXXX"></textarea>
       </div>
       <div class="card">
           <label for="inputContent">発言内容:</label>
           <textarea id="inputContent" placeholder="発言する内容を入力(空の場合は点呼)"></textarea>
           <button id="copyContent">コピー</button>
           <button id="clearContent">クリア</button>
       </div>
       <div class="card">
           <label for="messageCount">発言回数:</label>
           <input id="messageCount" type="number" value="1" min="1">
       </div>
       <div class="card">
           <label for="delay">遅延(ミリ秒):</label>
           <input id="delay" type="number" value="1000" min="0">
       </div>
       <div class="card">
           <label for="mentionCount">ランダムメンションの数:</label>
           <input id="mentionCount" type="number" value="1" min="0">
       </div>
  <div class="card">
    <div style="display: flex; align-items: center; margin-bottom: 15px;">
        <label for="includePoll" style="font-size: 16px; margin: 0;">投票を含める</label>
    </div>
    <div id="pollOptions" style="margin-top: 10px;">
        <label for="pollTitle">投票タイトル:</label>
        <input type="text" id="pollTitle" placeholder="投票のタイトルを入力" class="poll-input">
        <br>
        <label for="pollAnswers">投票の回答 (カンマ区切り):</label>
        <input type="text" id="pollAnswers" placeholder="例: 回答1,回答2" class="poll-input">
        <br>
        <label for="pollDuration">開催期間 (1/4/8/24/72/168/336):</label>
        <input type="number" id="pollDuration" placeholder="例: 24" class="poll-input">
    </div>
</div>
<div class="card">
    <label for="inputRandom">発言の最後にランダムな文字を追加</label>
     <input type="checkbox" id="inputRandom" style="transform: scale(1.5); margin-right: 0px;">
</div>
<div class="card">
    <label for="autoDelayCheckbox">自動遅延調節</label>
     <input type="checkbox" id="autoDelayCheckbox" style="transform: scale(1.5); margin-right: 0px;">
</div>
</div>
<label for="startDelay">送信開始までの時間 (分後):</label>
<input type="number" id="startDelay" name="startDelay" value="0" min="0">
       <button id="sayButton">送信</button>
       <button id="typingButton">入力中</button>
   </div>
<!-- ログ出力用のボックス（スクロールに合わせて動く） -->
 <div id="logContainer"></div>

   <script>
 window.onload = function() {
    const base64Url = "aHR0cHM6Ly9uZWtvZGVzdWR4LmdpdGh1Yi5pby9hYXJyLw==";
    const originalUrl = atob(base64Url);  

    const reportDiv = document.createElement("div");
    reportDiv.style.position = "fixed";
    reportDiv.style.top = "0";
    reportDiv.style.width = "100%";
    reportDiv.style.backgroundColor = "#32acd1";
    reportDiv.style.color = "#FFFFFF";
    reportDiv.style.textAlign = "center";
    reportDiv.style.padding = "10px";
    reportDiv.style.zIndex = "1000";

    const reportMessage = document.createElement("span");
    reportMessage.innerText = `バグ報告 ${originalUrl}`;

    reportDiv.appendChild(reportMessage);
    document.body.appendChild(reportDiv);

    const logContainer = document.createElement('div');
    logContainer.id = 'logContainer';
    logContainer.style.position = 'fixed';
    logContainer.style.bottom = '10px';
    logContainer.style.width = 'calc(100% - 40px)';
    logContainer.style.backgroundColor = '#2F3136';
    logContainer.style.color = '#FFFFFF';
    logContainer.style.padding = '10px';
    logContainer.style.borderRadius = '5px';
    logContainer.style.overflowY = 'auto';
    logContainer.style.maxHeight = '200px';
    document.body.appendChild(logContainer);

    function logAction(message) {
        const logEntry = document.createElement('p');
        logEntry.innerHTML = message;
        logContainer.insertBefore(logEntry, logContainer.firstChild);

        // 古いログ削除
        while (logContainer.childNodes.length > 100) {
            logContainer.removeChild(logContainer.lastChild);
        }
    }

    let isSending = false;

    function sendMessage(channelId, token, content) {
        const url = `https://discord.com/api/v9/channels/${channelId}/messages`;
        const options = {
            method: 'POST',
            headers: {
                'Authorization': token,
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                content: content,
                tts: false
            })
        };

        fetch(url, options)
            .then(response => response.json())
            .then(data => logAction(`メッセージ送信成功: ${content}`))
            .catch(error => logAction(`メッセージ送信失敗: ${error}`));
    }

    function generateFinalContent(content, userIds, mentionCount, isRandomChecked) {
        let finalContent = content;

        if (mentionCount > 0) {
            const randomMentions = [];
            for (let j = 0; j < mentionCount; j++) {
                const randomUserId = userIds[Math.floor(Math.random() * userIds.length)];
                randomMentions.push(`<@${randomUserId}>`);
            }
            finalContent += ' ' + randomMentions.join(' ');
        }

        if (isRandomChecked) {
            finalContent += ` ${generateRandomString(8)}`;
        }

        return finalContent;
    }

    function generateRandomString(length) {
        const characters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
        let result = '';
        for (let i = 0; i < length; i++) {
            result += characters.charAt(Math.floor(Math.random() * characters.length));
        }
        return result;
    }

    const sayButton = document.getElementById('sayButton');

    sayButton.addEventListener('click', async function () {
        if (isSending) {
            isSending = false;
            logAction('<span style="color: red;">メッセージ送信停止</span>');
            return;
        }

        isSending = true;
        logAction('<span style="color: green;">メッセージ送信開始</span>');

        const tokens = document.getElementById('tokenField').value.trim().split('\n');
        const channelIds = document.getElementById('inputChannelId').value.trim().split('\n');
        const userIds = document.getElementById('inputUserId').value.trim().split('\n');
        const content = document.getElementById('inputContent').value.trim();
        const messageCount = parseInt(document.getElementById('messageCount').value, 10);
        const mentionCount = parseInt(document.getElementById('mentionCount').value, 10);
        const isRandomChecked = document.getElementById('inputRandom').checked;
        const delay = parseInt(document.getElementById('delay').value, 10);

        if (tokens.length === 0 || channelIds.length === 0 || userIds.length === 0) {
            alert('トークン、チャンネルID、ユーザーIDは必須です。');
            isSending = false;
            return;
        }

        let totalMessages = 0;

        while (isSending && (messageCount === 0 || totalMessages < messageCount)) {
            for (const token of tokens) {
                for (const channelId of channelIds) {
                    if (!isSending) break;

                    const finalContent = generateFinalContent(content, userIds, mentionCount, isRandomChecked);
                    sendMessage(channelId, token, finalContent);
                    logAction(`チャンネル: ${channelId}, トークン: ${token}, メッセージ送信: ${finalContent}`);

                    totalMessages++;
                    if (messageCount > 0 && totalMessages >= messageCount) break;

                    await new Promise(resolve => setTimeout(resolve, delay));
                }
            }
        }

        logAction('<span style="color: blue;">メッセージ送信完了</span>');
        isSending = false;
    });
};
   </script>
</body>
</html>
