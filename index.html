<!DOCTYPE html>
<html lang="ja">
<head>
   <meta charset="UTF-8">
   <title>AARR tool</title>
   <meta name="description" content="message tool">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <meta name="theme-color" content="blue">
   <meta property="og:title" content="AARR tool">
   <meta property="og:description" content="メッセージ送信ツールです">
   <meta property="og:image" content="https://i.imgur.com/JTkB9AC.png">
   <link rel="stylesheet" href="style.css">

   <style>
       /* 全体のスタイル */
       body {
           font-family: "Arial", sans-serif;
           margin: 0;
           padding: 0;
           background-color: #36393F;
           color: #FFFFFF;
       }

       /* コンテナのスタイル */
       #app {
           max-width: 800px;
           margin: 20px auto;
           background-color: #2F3136;
           padding: 20px;
           border-radius: 8px;
           box-shadow: 0 4px 10px rgba(0, 0, 0, 0.5);
       }

       /* タイトルや説明用のスタイル */
       h1, h2 {
           color: #FFFFFF;
       }

       .description {
           background-color: #202225;
           padding: 15px;
           border-radius: 8px;
           color: #B9BBBE;
           margin-bottom: 20px;
       }

       /* 入力フィールドのスタイル */
       input, textarea {
           width: calc(100% - 24px);
           padding: 10px;
           margin: 10px 0;
           border: none;
           border-radius: 5px;
           background-color: #40444B;
           color: #FFFFFF;
           font-size: 14px;
       }

       textarea {
           resize: vertical;
           height: 100px;
       }

       /* ボタンのスタイル */
       button {
           padding: 10px 20px;
           margin: 5px 0;
           background-color: #5865F2;
           color: #FFFFFF;
           border: none;
           border-radius: 5px;
           font-size: 14px;
           cursor: pointer;
           transition: background-color 0.2s;
       }

       button:hover {
           background-color: #4752C4;
       }

       button:disabled {
           background-color: #4F545C;
           cursor: not-allowed;
       }

       /* カードやセクションを分けるスタイル */
       .card {
           background-color: #202225;
           padding: 15px;
           border-radius: 8px;
           margin-bottom: 20px;
           box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
       }

       /* リンクのスタイル */
       a {
           color: #5865F2;
           text-decoration: none;
       }

       a:hover {
           text-decoration: underline;
       }
   </style>
</head>
<body>
   <div id="app">
       <h1>AARR tool</h1>
       <div class="description">
           <a href="https://discord.gg/DPmPdpcNqs" target="_blank">開発者サポートサーバー(discord)</a>
           <a href="https://youtu.be/NTrzk7bxotg?si=Nd482zjloHVn6V4R" target="_blank">token取得方法(youtube)</a>
           <a href="https://nekodesudx.github.io/DM/" target="_blank">グループ追加ツール(github)</a>
           <a href="https://nekodesudx.github.io/emoji-ja/" target="_blank">絵文字追加ツール(github)</a>
       </div>
       <div class="card">
           <label for="tokenField">トークン:</label>
           <input id="tokenField" type="text" placeholder="ユーザートークンを入力してください">
       </div>
       <div class="card">
           <label for="inputChannelId">チャンネルID:</label>
           <textarea id="inputChannelId" placeholder="発言するチャンネルのIDを改行で区切って入力\n\n例:\nXXXXXXXXXXXXXXXXXX\nXXXXXXXXXXXXXXXXXX"></textarea>
           <button id="copyChannelId">コピー</button>
           <button id="clearChannelId">クリア</button>
       </div>
       <div class="card">
           <label for="inputContent">発言内容:</label>
           <textarea id="inputContent" placeholder="発言する内容を入力(空の場合は点呼)"></textarea>
           <button id="copyContent">コピー</button>
           <button id="clearContent">クリア</button>
       </div>
       <div class="card">
           <label for="inputRandom">発言の最後にランダムな文字を追加</label>
           <input id="inputRandom" type="checkbox">
       </div>
       <button id="sayButton">送信</button>
       <button id="typingButton">入力中</button>
   </div>

   <script>
       (function() {
           'use strict';

           // 入力フィールドとボタンの取得
           const tokenField = document.getElementById('tokenField');
           const inputChannelId = document.getElementById('inputChannelId');
           const inputContent = document.getElementById('inputContent');
           const inputRandom = document.getElementById('inputRandom');
           const sayButton = document.getElementById('sayButton');
           const typingButton = document.getElementById('typingButton');
           const copyChannelId = document.getElementById('copyChannelId');
           const clearChannelId = document.getElementById('clearChannelId');
           const copyContent = document.getElementById('copyContent');
           const clearContent = document.getElementById('clearContent');

           // チャンネルIDのコピーとクリア
           copyChannelId.addEventListener('click', function() {
               navigator.clipboard.writeText(inputChannelId.value);
               inputChannelId.select();
           });

           clearChannelId.addEventListener('click', function() {
               inputChannelId.value = '';
           });

           // 発言内容のコピーとクリア
           copyContent.addEventListener('click', function() {
               navigator.clipboard.writeText(inputContent.value);
               inputContent.select();
           });

           clearContent.addEventListener('click', function() {
               inputContent.value = '';
           });

           // チャンネルIDの入力形式をチェック
           inputChannelId.addEventListener('change', function() {
               inputChannelId.value = inputChannelId.value.split('\n').map(function(v) {
                   const m = v.match(/^https?:\/\/discord\.com\/channels\/[0-9]+\/([0-9]+)\/?$/) || v.match(/^([0-9]+)$/);
                   return m ? m[1] : '';
               }).filter(function(x, i, arr) {
                   return (arr.indexOf(x) === i && x.length > 0);
               }).join('\n');
           });

           // メッセージ送信関数
           function sendMessage(channelId, token, content) {
               fetch(`https://discord.com/api/v9/channels/${channelId}/messages`, {
                   method: 'POST',
                   headers: {
                       'Authorization': token,
                       'Content-Type': 'application/json'
                   },
                   body: JSON.stringify({
                       content: content,
                       tts: false
                   })
               })
               .then(response => response.json())
               .then(data => {
                   console.log('送信成功:', data);
                   alert('メッセージが送信されました。');
               })
               .catch(error => {
                   console.error('送信エラー:', error);
                   alert('送信中にエラーが発生しました。');
               });
           }

           // 発言ボタンクリック時のイベント処理
           sayButton.addEventListener('click', function() {
               const token = tokenField.value.trim();
               const channelIds = inputChannelId.value.trim().split('\n');
               const content = inputContent.value.trim() + (inputRandom.checked ? String.fromCharCode(Math.random() * Math.pow(2, 16)) : '');

               if (!token) {
                   alert('トークンが入力されていません。');
                   return;
               }

               if (channelIds.length === 0) {
                   alert('チャンネルIDが入力されていません。');
                   return;
               }

               channelIds.forEach(channelId => {
                   sendMessage(channelId, token, content);
               });
           });

           // 入力中ボタンクリック時のイベント処理
           typingButton.addEventListener('click', function() {
               const token = tokenField.value.trim();
               const channelIds = inputChannelId.value.trim().split('\n');

               if (!token) {
                   alert('トークンが入力されていません。');
                   return;
               }

               if (channelIds.length === 0) {
                   alert('チャンネルIDが入力されていません。');
                   return;
               }

               channelIds.forEach(channelId => {
                   fetch(`https://discord.com/api/v9/channels/${channelId}/typing`, {
                       method: 'POST',
                       headers: {
                           'Authorization': token
                       }
                   })
                   .then(response => {
                       if (!response.ok) {
                           throw new Error('Network response was not ok');
                       }
                       console.log('入力中:', channelId);
                   })
                   .catch(error => {
                       console.error('入力中エラー:', error);
                   });
               });
           });
       })();
   </script>
</body>
</html>
